import { error, getPlayerPath } from 'stateUtils';
import logger from 'service/logger';

const trader = (state, player) => {
    logger.debug('traders: %j, plater: %s, resource: %s', state.get('traders'), player);
    
    return state.setIn([...getPlayerPath(state, player), 'canPlaceTrader'], true);
};

const placeTrader = (state, player, resource) => {
    logger.debug('traders: %j, player: %s, resource, %s', state.get('traders').toJS(), player, resource);
    if (resource == 'silver' && !['sand', 'wood', 'bricks', 'stone'].every(r => state.getIn(['traders', r]))) {
        return error(state, {
            player,
            resource,
            error: 'can\'t place trader in silver while there are other vacant places'
        });
    }

    return state.updateIn(['traders', resource], player);
};

export {
    trader,
    placeTrader
};
